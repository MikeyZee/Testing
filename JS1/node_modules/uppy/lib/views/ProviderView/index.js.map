{"version":3,"sources":["../../../src/views/ProviderView/index.js"],"names":["AuthView","require","Browser","LoaderView","Utils","h","Component","findIndex","array","predicate","i","length","CloseWrapper","componentWillUnmount","props","onUnmount","render","children","module","exports","plugin","opts","Provider","id","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","addFile","bind","filterItems","filterQuery","toggleSearch","getFolder","getNextFolder","logout","checkAuth","handleAuth","handleDemoAuth","sortByTitle","sortByDate","isActiveRow","isChecked","toggleCheckbox","handleError","handleScroll","donePicking","cancelPicking","clearSelection","tearDown","_updateFilesAndFolders","res","files","folders","getItemSubList","forEach","item","isFolder","push","setPluginState","checkAuthInProgress","then","authenticated","onAuth","catch","err","name","_loaderWrapper","list","updatedDirectories","state","getPluginState","index","directories","dir","slice","concat","title","getItemName","username","getUsername","folder","getItemRequestPath","lastCheckbox","undefined","file","tagFile","providerFileToId","source","data","getItemData","getItemId","type","getMimeType","isRemote","body","fileId","remote","host","url","fileUrl","providerOptions","fileType","getFileType","isPreviewSupported","preview","getItemThumbnailUrl","uppy","log","removeFile","currentSelection","filter","location","href","ok","newState","e","filterInput","target","value","inputEl","isSearchVisible","items","toLowerCase","indexOf","sorting","sortedFiles","sort","fileA","fileB","localeCompare","sortedFolders","folderA","folderB","a","Date","getItemModifiedDate","b","sortBySize","size","activeRow","some","addFolder","folderId","selectedFolders","loading","dashboard","getPlugin","message","i18n","smart_count","info","stopPropagation","preventDefault","shiftKey","prevIndex","currentIndex","generateFileID","authState","btoa","JSON","stringify","origin","link","authUrl","authWindow","window","open","noProtocol","replace","handleToken","allowedOrigin","RegExp","hostPattern","test","console","close","removeEventListener","setAuthToken","token","addEventListener","error","toString","details","scrollPos","scrollHeight","scrollTop","offsetHeight","path","getNextPagePath","_isHandlingScroll","promises","map","all","hideAllPanels","promise","catch_","icon","demo","browserProps","getItemIcon","done","cancel","pluginIcon"],"mappings":"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","file":"index.js","sourcesContent":["const AuthView = require('./AuthView')\nconst Browser = require('./Browser')\nconst LoaderView = require('./Loader')\nconst Utils = require('../../core/Utils')\nconst { h, Component } = require('preact')\n\n/**\n * Array.prototype.findIndex ponyfill for old browsers.\n */\nfunction findIndex (array, predicate) {\n  for (let i = 0; i < array.length; i++) {\n    if (predicate(array[i])) return i\n  }\n  return -1\n}\n\nclass CloseWrapper extends Component {\n  componentWillUnmount () {\n    this.props.onUnmount()\n  }\n\n  render () {\n    return this.props.children[0]\n  }\n}\n\n/**\n * Class to easily generate generic views for plugins\n *\n *\n * This class expects the plugin instance using it to have the following\n * accessor methods.\n * Each method takes the item whose property is to be accessed\n * as a param\n *\n * isFolder\n *    @return {Boolean} for if the item is a folder or not\n * getItemData\n *    @return {Object} that is format ready for uppy upload/download\n * getItemIcon\n *    @return {Object} html instance of the item's icon\n * getItemSubList\n *    @return {Array} sub-items in the item. e.g a folder may contain sub-items\n * getItemName\n *    @return {String} display friendly name of the item\n * getMimeType\n *    @return {String} mime type of the item\n * getItemId\n *    @return {String} unique id of the item\n * getItemRequestPath\n *    @return {String} unique request path of the item when making calls to uppy server\n * getItemModifiedDate\n *    @return {object} or {String} date of when last the item was modified\n * getItemThumbnailUrl\n *    @return {String}\n */\nmodule.exports = class ProviderView {\n  /**\n   * @param {object} instance of the plugin\n   */\n  constructor (plugin, opts) {\n    this.plugin = plugin\n    this.Provider = plugin[plugin.id]\n\n    // set default options\n    const defaultOptions = {\n      viewType: 'list',\n      showTitles: true,\n      showFilter: true,\n      showBreadcrumbs: true\n    }\n\n    // merge default options with the ones set by user\n    this.opts = Object.assign({}, defaultOptions, opts)\n\n    // Logic\n    this.addFile = this.addFile.bind(this)\n    this.filterItems = this.filterItems.bind(this)\n    this.filterQuery = this.filterQuery.bind(this)\n    this.toggleSearch = this.toggleSearch.bind(this)\n    this.getFolder = this.getFolder.bind(this)\n    this.getNextFolder = this.getNextFolder.bind(this)\n    this.logout = this.logout.bind(this)\n    this.checkAuth = this.checkAuth.bind(this)\n    this.handleAuth = this.handleAuth.bind(this)\n    this.handleDemoAuth = this.handleDemoAuth.bind(this)\n    this.sortByTitle = this.sortByTitle.bind(this)\n    this.sortByDate = this.sortByDate.bind(this)\n    this.isActiveRow = this.isActiveRow.bind(this)\n    this.isChecked = this.isChecked.bind(this)\n    this.toggleCheckbox = this.toggleCheckbox.bind(this)\n    this.handleError = this.handleError.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n    this.cancelPicking = this.cancelPicking.bind(this)\n    this.clearSelection = this.clearSelection.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    this.clearSelection()\n  }\n\n  tearDown () {\n    // Nothing.\n  }\n\n  _updateFilesAndFolders (res, files, folders) {\n    this.plugin.getItemSubList(res).forEach((item) => {\n      if (this.plugin.isFolder(item)) {\n        folders.push(item)\n      } else {\n        files.push(item)\n      }\n    })\n\n    this.plugin.setPluginState({ folders, files })\n  }\n\n  checkAuth () {\n    this.plugin.setPluginState({ checkAuthInProgress: true })\n    this.Provider.checkAuth()\n      .then((authenticated) => {\n        this.plugin.setPluginState({ checkAuthInProgress: false })\n        this.plugin.onAuth(authenticated)\n      })\n      .catch((err) => {\n        this.plugin.setPluginState({ checkAuthInProgress: false })\n        this.handleError(err)\n      })\n  }\n\n  /**\n   * Based on folder ID, fetch a new folder and update it to state\n   * @param  {String} id Folder id\n   * @return {Promise}   Folders/files in folder\n   */\n  getFolder (id, name) {\n    return this._loaderWrapper(\n      this.Provider.list(id),\n      (res) => {\n        let folders = []\n        let files = []\n        let updatedDirectories\n\n        const state = this.plugin.getPluginState()\n        const index = findIndex(state.directories, (dir) => id === dir.id)\n\n        if (index !== -1) {\n          updatedDirectories = state.directories.slice(0, index + 1)\n        } else {\n          updatedDirectories = state.directories.concat([{id, title: name || this.plugin.getItemName(res)}])\n        }\n\n        this.username = this.username ? this.username : this.plugin.getUsername(res)\n        this._updateFilesAndFolders(res, files, folders)\n        this.plugin.setPluginState({ directories: updatedDirectories })\n      },\n      this.handleError)\n  }\n\n  /**\n   * Fetches new folder\n   * @param  {Object} Folder\n   * @param  {String} title Folder title\n   */\n  getNextFolder (folder) {\n    let id = this.plugin.getItemRequestPath(folder)\n    this.getFolder(id, this.plugin.getItemName(folder))\n    this.lastCheckbox = undefined\n  }\n\n  addFile (file) {\n    const tagFile = {\n      id: this.providerFileToId(file),\n      source: this.plugin.id,\n      data: this.plugin.getItemData(file),\n      name: this.plugin.getItemName(file) || this.plugin.getItemId(file),\n      type: this.plugin.getMimeType(file),\n      isRemote: true,\n      body: {\n        fileId: this.plugin.getItemId(file)\n      },\n      remote: {\n        host: this.plugin.opts.host,\n        url: `${this.Provider.fileUrl(this.plugin.getItemRequestPath(file))}`,\n        body: {\n          fileId: this.plugin.getItemId(file)\n        },\n        providerOptions: this.Provider.opts\n      }\n    }\n\n    const fileType = Utils.getFileType(tagFile)\n    // TODO Should we just always use the thumbnail URL if it exists?\n    if (fileType && Utils.isPreviewSupported(fileType)) {\n      tagFile.preview = this.plugin.getItemThumbnailUrl(file)\n    }\n    this.plugin.uppy.log('Adding remote file')\n    try {\n      this.plugin.uppy.addFile(tagFile)\n    } catch (err) {\n      // Nothing, restriction errors handled in Core\n    }\n  }\n\n  removeFile (id) {\n    const { currentSelection } = this.plugin.getPluginState()\n    this.plugin.setPluginState({\n      currentSelection: currentSelection.filter((file) => file.id !== id)\n    })\n  }\n\n  /**\n   * Removes session token on client side.\n   */\n  logout () {\n    this.Provider.logout(location.href)\n      .then((res) => {\n        if (res.ok) {\n          const newState = {\n            authenticated: false,\n            files: [],\n            folders: [],\n            directories: []\n          }\n          this.plugin.setPluginState(newState)\n        }\n      }).catch(this.handleError)\n  }\n\n  filterQuery (e) {\n    const state = this.plugin.getPluginState()\n    this.plugin.setPluginState(Object.assign({}, state, {\n      filterInput: e ? e.target.value : ''\n    }))\n  }\n\n  toggleSearch (inputEl) {\n    const state = this.plugin.getPluginState()\n\n    this.plugin.setPluginState({\n      isSearchVisible: !state.isSearchVisible,\n      filterInput: ''\n    })\n  }\n\n  filterItems (items) {\n    const state = this.plugin.getPluginState()\n    if (state.filterInput === '') {\n      return items\n    }\n    return items.filter((folder) => {\n      return this.plugin.getItemName(folder).toLowerCase().indexOf(state.filterInput.toLowerCase()) !== -1\n    })\n  }\n\n  sortByTitle () {\n    const state = Object.assign({}, this.plugin.getPluginState())\n    const {files, folders, sorting} = state\n\n    let sortedFiles = files.sort((fileA, fileB) => {\n      if (sorting === 'titleDescending') {\n        return this.plugin.getItemName(fileB).localeCompare(this.plugin.getItemName(fileA))\n      }\n      return this.plugin.getItemName(fileA).localeCompare(this.plugin.getItemName(fileB))\n    })\n\n    let sortedFolders = folders.sort((folderA, folderB) => {\n      if (sorting === 'titleDescending') {\n        return this.plugin.getItemName(folderB).localeCompare(this.plugin.getItemName(folderA))\n      }\n      return this.plugin.getItemName(folderA).localeCompare(this.plugin.getItemName(folderB))\n    })\n\n    this.plugin.setPluginState(Object.assign({}, state, {\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: (sorting === 'titleDescending') ? 'titleAscending' : 'titleDescending'\n    }))\n  }\n\n  sortByDate () {\n    const state = Object.assign({}, this.plugin.getPluginState())\n    const {files, folders, sorting} = state\n\n    let sortedFiles = files.sort((fileA, fileB) => {\n      let a = new Date(this.plugin.getItemModifiedDate(fileA))\n      let b = new Date(this.plugin.getItemModifiedDate(fileB))\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    let sortedFolders = folders.sort((folderA, folderB) => {\n      let a = new Date(this.plugin.getItemModifiedDate(folderA))\n      let b = new Date(this.plugin.getItemModifiedDate(folderB))\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    this.plugin.setPluginState(Object.assign({}, state, {\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: (sorting === 'dateDescending') ? 'dateAscending' : 'dateDescending'\n    }))\n  }\n\n  sortBySize () {\n    const state = Object.assign({}, this.plugin.getPluginState())\n    const {files, sorting} = state\n\n    // check that plugin supports file sizes\n    if (!files.length || !this.plugin.getItemData(files[0]).size) {\n      return\n    }\n\n    let sortedFiles = files.sort((fileA, fileB) => {\n      let a = this.plugin.getItemData(fileA).size\n      let b = this.plugin.getItemData(fileB).size\n\n      if (sorting === 'sizeDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    this.plugin.setPluginState(Object.assign({}, state, {\n      files: sortedFiles,\n      sorting: (sorting === 'sizeDescending') ? 'sizeAscending' : 'sizeDescending'\n    }))\n  }\n\n  isActiveRow (file) {\n    return this.plugin.getPluginState().activeRow === this.plugin.getItemId(file)\n  }\n\n  isChecked (file) {\n    const { currentSelection } = this.plugin.getPluginState()\n    return currentSelection.some((item) => item === file)\n  }\n\n  /**\n   * Adds all files found inside of specified folder.\n   *\n   * Uses separated state while folder contents are being fetched and\n   * mantains list of selected folders, which are separated from files.\n   */\n  addFolder (folder) {\n    const folderId = this.providerFileToId(folder)\n    let state = this.plugin.getPluginState()\n    let folders = state.selectedFolders || {}\n    if (folderId in folders && folders[folderId].loading) {\n      return\n    }\n    folders[folderId] = {loading: true, files: []}\n    this.plugin.setPluginState({selectedFolders: folders})\n    return this.Provider.list(this.plugin.getItemRequestPath(folder)).then((res) => {\n      let files = []\n      this.plugin.getItemSubList(res).forEach((item) => {\n        if (!this.plugin.isFolder(item)) {\n          this.addFile(item)\n          files.push(this.providerFileToId(item))\n        }\n      })\n      state = this.plugin.getPluginState()\n      state.selectedFolders[folderId] = {loading: false, files: files}\n      this.plugin.setPluginState({selectedFolders: folders})\n      const dashboard = this.plugin.uppy.getPlugin('Dashboard')\n      let message\n      if (files.length) {\n        message = dashboard.i18n('folderAdded', {\n          smart_count: files.length, folder: this.plugin.getItemName(folder)\n        })\n      } else {\n        message = dashboard.i18n('emptyFolderAdded')\n      }\n      this.plugin.uppy.info(message)\n    }).catch((e) => {\n      state = this.plugin.getPluginState()\n      delete state.selectedFolders[folderId]\n      this.plugin.setPluginState({selectedFolders: state.selectedFolders})\n      this.handleError(e)\n    })\n  }\n\n  /**\n   * Toggles file/folder checkbox to on/off state while updating files list.\n   *\n   * Note that some extra complexity comes from supporting shift+click to\n   * toggle multiple checkboxes at once, which is done by getting all files\n   * in between last checked file and current one.\n   */\n  toggleCheckbox (e, file) {\n    e.stopPropagation()\n    e.preventDefault()\n    let { folders, files } = this.plugin.getPluginState()\n    let items = this.filterItems(folders.concat(files))\n\n    // Shift-clicking selects a single consecutive list of items\n    // starting at the previous click and deselects everything else.\n    if (this.lastCheckbox && e.shiftKey) {\n      let currentSelection\n      const prevIndex = items.indexOf(this.lastCheckbox)\n      const currentIndex = items.indexOf(file)\n      if (prevIndex < currentIndex) {\n        currentSelection = items.slice(prevIndex, currentIndex + 1)\n      } else {\n        currentSelection = items.slice(currentIndex, prevIndex + 1)\n      }\n      this.plugin.setPluginState({ currentSelection })\n      return\n    }\n\n    this.lastCheckbox = file\n    const { currentSelection } = this.plugin.getPluginState()\n    if (this.isChecked(file)) {\n      this.plugin.setPluginState({\n        currentSelection: currentSelection.filter((item) => item !== file)\n      })\n    } else {\n      this.plugin.setPluginState({\n        currentSelection: currentSelection.concat([file])\n      })\n    }\n  }\n\n  providerFileToId (file) {\n    return Utils.generateFileID({\n      data: this.plugin.getItemData(file),\n      name: this.plugin.getItemName(file) || this.plugin.getItemId(file),\n      type: this.plugin.getMimeType(file)\n    })\n  }\n\n  handleDemoAuth () {\n    const state = this.plugin.getPluginState()\n    this.plugin.setPluginState({}, state, {\n      authenticated: true\n    })\n  }\n\n  handleAuth () {\n    const authState = btoa(JSON.stringify({ origin: location.origin }))\n    const link = `${this.Provider.authUrl()}?state=${authState}`\n\n    const authWindow = window.open(link, '_blank')\n    const noProtocol = (url) => url.replace(/^(https?:|)\\/\\//, '')\n    const handleToken = (e) => {\n      const allowedOrigin = new RegExp(noProtocol(this.plugin.opts.hostPattern))\n      if (!allowedOrigin.test(noProtocol(e.origin)) || e.source !== authWindow) {\n        console.log(`rejecting event from ${e.origin} vs allowed pattern ${this.plugin.opts.hostPattern}`)\n        return\n      }\n      authWindow.close()\n      window.removeEventListener('message', handleToken)\n      this.Provider.setAuthToken(e.data.token)\n      this._loaderWrapper(this.Provider.checkAuth(), this.plugin.onAuth, this.handleError)\n    }\n    window.addEventListener('message', handleToken)\n  }\n\n  handleError (error) {\n    const uppy = this.plugin.uppy\n    const message = uppy.i18n('uppyServerError')\n    uppy.log(error.toString())\n    uppy.info({message: message, details: error.toString()}, 'error', 5000)\n  }\n\n  handleScroll (e) {\n    const scrollPos = e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight)\n    const path = this.plugin.getNextPagePath ? this.plugin.getNextPagePath() : null\n\n    if (scrollPos < 50 && path && !this._isHandlingScroll) {\n      this.Provider.list(path)\n        .then((res) => {\n          const { files, folders } = this.plugin.getPluginState()\n          this._updateFilesAndFolders(res, files, folders)\n        }).catch(this.handleError)\n        .then(() => { this._isHandlingScroll = false }) // always called\n\n      this._isHandlingScroll = true\n    }\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    const promises = currentSelection.map((file) => {\n      if (this.plugin.isFolder(file)) {\n        return this.addFolder(file)\n      } else {\n        return this.addFile(file)\n      }\n    })\n\n    this._loaderWrapper(Promise.all(promises), () => {\n      this.clearSelection()\n\n      const dashboard = this.plugin.uppy.getPlugin('Dashboard')\n      if (dashboard) dashboard.hideAllPanels()\n    }, () => {})\n  }\n\n  cancelPicking () {\n    this.clearSelection()\n\n    const dashboard = this.plugin.uppy.getPlugin('Dashboard')\n    if (dashboard) dashboard.hideAllPanels()\n  }\n\n  clearSelection () {\n    this.plugin.setPluginState({ currentSelection: [] })\n  }\n\n  // displays loader view while asynchronous request is being made.\n  _loaderWrapper (promise, then, catch_) {\n    promise\n      .then(then).catch(catch_)\n      .then(() => this.plugin.setPluginState({ loading: false })) // always called.\n    this.plugin.setPluginState({ loading: true })\n  }\n\n  render (state) {\n    const { authenticated, checkAuthInProgress, loading } = this.plugin.getPluginState()\n\n    if (loading) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <LoaderView />\n        </CloseWrapper>\n      )\n    }\n\n    if (!authenticated) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <AuthView\n            pluginName={this.plugin.title}\n            pluginIcon={this.plugin.icon}\n            demo={this.plugin.opts.demo}\n            checkAuth={this.checkAuth}\n            handleAuth={this.handleAuth}\n            handleDemoAuth={this.handleDemoAuth}\n            checkAuthInProgress={checkAuthInProgress} />\n        </CloseWrapper>\n      )\n    }\n\n    const browserProps = Object.assign({}, this.plugin.getPluginState(), {\n      username: this.username,\n      getNextFolder: this.getNextFolder,\n      getFolder: this.getFolder,\n      filterItems: this.filterItems,\n      filterQuery: this.filterQuery,\n      toggleSearch: this.toggleSearch,\n      sortByTitle: this.sortByTitle,\n      sortByDate: this.sortByDate,\n      logout: this.logout,\n      demo: this.plugin.opts.demo,\n      isActiveRow: this.isActiveRow,\n      isChecked: this.isChecked,\n      toggleCheckbox: this.toggleCheckbox,\n      getItemId: this.plugin.getItemId,\n      getItemName: this.plugin.getItemName,\n      getItemIcon: this.plugin.getItemIcon,\n      handleScroll: this.handleScroll,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      title: this.plugin.title,\n      viewType: this.opts.viewType,\n      showTitles: this.opts.showTitles,\n      showFilter: this.opts.showFilter,\n      showBreadcrumbs: this.opts.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n\n    })\n\n    return (\n      <CloseWrapper onUnmount={this.clearSelection}>\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"]}